# KNN 优化快速参考

> 一页纸快速理解窗口筛选优化

## 🎯 30秒理解

**窗口筛选**：通过风速和空气密度范围预筛选候选点

```
查询点 (风速, 密度)
    ↓
只考虑相似工况点
    ↓
筛除 50%-80% 不相关点
    ↓
减少计算量，提速 1.5-2倍
```

## ⚡ 快速配置

**复制即用**（已在配置文件中）：

```json
{
  "thresholds": {
    "use_window_filter": true,
    "window_v": 0.1,
    "window_r": 0.2,
    "min_candidates": 1000
  }
}
```

## 📝 参数说明

| 参数 | 含义 | 推荐值 | 说明 |
|------|------|--------|------|
| `window_v` | 风速窗口半径 | 0.1 | 0.05-0.2，越小越严格 |
| `window_r` | 密度窗口半径 | 0.2 | 0.1-0.3，越小越严格 |
| `min_candidates` | 最小候选数 | 1000 | 确保足够的邻居 |

### 窗口大小选择

**MinMax 归一化 [0,1]**:
- `window_v: 0.1` ≈ 原始空间 ±1.5 m/s
- `window_r: 0.2` ≈ 原始空间 ±0.06 kg/m³

**Z-score 归一化**:
- `window_v: 0.5` ≈ 0.5 个标准差
- `window_r: 1.0` ≈ 1.0 个标准差

## 🎛️ 快速调优

### 默认配置（推荐）
```json
{"window_v": 0.1, "window_r": 0.2}
```
- 适合大多数情况
- 平衡筛除率和候选数

### 数据稀疏？
```json
{"window_v": 0.15, "window_r": 0.3}
```
- 扩大窗口
- 确保足够候选

### 数据密集？
```json
{"window_v": 0.05, "window_r": 0.1}
```
- 缩小窗口
- 更严格筛选

## 📊 性能表现

| 窗口配置 | 筛除率 | 提速 |
|---------|--------|------|
| 默认 (0.1/0.2) | 54-70% | 1.5-2x |
| 宽松 (0.2/0.3) | 30-50% | 1.2-1.5x |
| 严格 (0.05/0.1) | 70-85% | 2-3x |

## ❓ 常见问题

### Q: 需要 KDTree 吗？
**A**: 不需要。KDTree 已默认禁用，窗口筛选已足够高效。

### Q: GPU 支持吗？
**A**: 完全支持。窗口筛选在 GPU 和 CPU 都能使用。

### Q: 性能提升多少？
**A**: 通常 50%-80% 候选筛除，1.5-2 倍提速。

### Q: 窗口太小会怎样？
**A**: 系统会自动扩大窗口（最多3次），确保有足够候选点。

### Q: 如何验证效果？
**A**: 查看运行日志中的 `avg candidates X/N (Y% reduction)` 信息。

## 🚀 立即使用

**无需修改配置**（默认已启用）：

```bash
python main.py --config experiments_compare_不同切向比例_分风机_JSMZS51-58.json
```

日志会显示：
```
[KNNLocal] Using window filtering (window_v=0.1, window_r=0.2)
[KNNLocal] Window filtering: avg candidates 15000/50000 (70% reduction)
```

## 📚 了解更多

- **详细使用**: USER_GUIDE.md
- **优化原理**: OPTIMIZATION_GUIDE.md
- **完整总结**: OPTIMIZATION_CHANGES_SUMMARY.md

---

**简单、高效、易用 - 这就是窗口筛选！** ⭐
